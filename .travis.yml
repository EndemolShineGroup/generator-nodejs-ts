language: node_js

cache: yarn

node_js:
  - 8
  - 10

before_install:
  - npm i -g yarn

script:
  - yarn lint
  - yarn build
  - yarn test

# Environment variables marked with `secure` should be securely encrypted as described at:
# https://docs.travis-ci.com/user/environment-variables/#encrypting-environment-variables

notifications:
  slack:
    secure: "j/o39OROYDcvHRA50DbfJ5Q/HCnw2j5c2jnsxS9nCRxjq6F2vlqcmL34QyYZO83OAOTcBn3rcNx8VuQ0F0yK9QDwWnoPemUPhhhpKm09IQboSR+SEazbN0P7S4+tGzhNLqx3rgrKUzcNSI4M7ExJaydTZZSmymL/Yj3uvBvBByzsInju3/QwCoXY1aLniVv3wFFLo/FP9WyweS2YOxdBI18Onniwcs2ZBxjvPg93xTWCTfwMa/jrmOEB3mZFiAw8Pb5XQ/oDd/WFy3N/NEceRG08dVePB5DDc2okS6FNTy4SESfVgW/HimwH9idRkt1/489sFWZsBsTYwaAjcD+N4BgOW1PT+4EGfmaOjBWBxxBrrSKfFuC88mTv5xFJDJrShAQAapwwi0v70FSQvC9hyu/tOu5umflN9AbTvxv8tWj2pfAswNO4CecHgEWHmQQMIGIKistlNi4UIwVeHE286dY6obYDEpm8lqnHBLyCC7D7iSV9s5SCaU0sIVqs03AhUFYOgogg/xS/G4i1Cs3t5kWOxsxGUi/gt3LypG9FcJDYupWeOCDwWWjz5GTtM7z8y1NRvC3uUCA/moF0CIFfRhyWC73mRVZDuA9AJwUUYeRLm2hAfDbP2vE1DKt2tK/fptz6OLkISYSRkSIFx8yjPjvf2A0ywNoaBxKFuHIZt6c="
env:
  global:
    # GH
    - secure: "nIwdBwLmIXp6oDHtdQZirZI1X1+oQF0oEhfZ8pQjC52WAvcx6vMLChqcbEkpueAEZcZ9iN35MZXvGVAosMx6PQ6fz+G7qDSDBdGuhdxLABAV2AM/Et/x5jjTObExXoW4yNfWi7XqlQRoB5b1g5tMznf2tZc1FellNuk0KGX4YWErDEYdGM1aE+gPuljkb4fQy9DKgKoXbxBecETF2zKtz63PMfQdrff40ujclsAc18kgVvmP7hTf/1V528RHJafmhO0E+eT3tiqhoobIg+2CTfoMatsfLjGk5NVD4XPctDqBf9VLsYowCHS5hx/l7q75WEcSAoTE0geOU/e/y5TUW1PmuFUKeFDhTnte/E5wVaDjdUR+YtJVisgu2LH0+ebCuXh9s3K8rxr588mMtqtA9nUZu/5XBtsNbd0/8pkUyuf0+K8S3xbl9uR1pJ/FzNMFK1wmSvj/MHxARVFRf0ihPACDaALEKdHL/Z6Z/RruSgWlZXWiWKBbQ9Uv8sRR9rIUQEVTS0AgW8IV6BjFRCAo2okzxiRkkWjOXrjv5LSR3WYAIC/R/CycdwQUQJgZ0t4MbqHv08QVlrCiCndEfrsu3Atjyb9AZkrPKFamiepqXoKigolW8iVPpVQnsz1oYHbhalhbu1M68fBcPwlgINxKN9Wa9IbUkIfGvOB3yJoxccA="
    # NPM
    - secure: "BpKl3NC8nB33wPsBu8V9OaBv2VZG9OOpcusfUkFM79Fi3UY+d01sxA0x/RCMDfmP1OCyULwMInghAqh8epSJiGgldpjjmBtLi6BP+i36TQ9m6kmiuwuFOuejFZNm7AS3kqfr5JLoFviEvx5ofYtq9dP0vUfe0cFXRlxaZSrPGApWr+8E+5McPjjaQIcP5lRTRBpDB+ihBYeBs3t5yqcv2adyXZymxDZKWuWR7HVUqjBESCjqekQBzIkE2sVMQcU9xc50vY4vN3v4k/WpfCoH0DKD1QvylA/PXOBszyVHOwvo//1TCWZdN07fOJcm+UiBbsNuZ7ysZinf+atoAZCgdnXpa50P4055ZVUZtPLe8LnCvsqjRlrYeZqvkEfAFtuMjBCgkuCnmiivm+o7D4L81IGUce21F++I5eQcA4W4ak5wP0jkrWZuwJXZ/n2Jn+mBrENov/AhW/sZV+hWfRPeMMxypvX24DSXBOEcLe+7Vsso9r6E0LdIAG+y4QeE+DZ5oWryzgasQBpolpxl1PYrE44qF6/BHQcwT4UxRqW+lBVd1cmOjyGR8qiipYUDOROJBUjKnTG13TzfsxpwY86poWHJnSqudyuTHL83udUNFOFJu/SSBZ5Wb1s7pF1DTmA+pX8RWGe+dCEVHkux6NjAsweg9jPTC+QfqkQSDG7drpw="
    # CC
    - secure: "KkIM+AjivhyIU4teDYl/TOdZEafKiQFwtORcKYQt1puRW5k6dOYlgPN7pZkeH5swrzI0UJwDBWonA/eAgKkik0VrRxiDc3obNNowZ9DUqA5TGeX49VSfJOSNFSY05eq5SzuEFw4XPEIbCLe4h1jPNJrHH9eGKPrVEkPRul3DmY57kCA7TVTjw6FjFZhaoev6IOMCGesJh62KFehFFRrNLIH1n3uHmn4lKNDFtJmlGV60Hm3s+hsbBQzs+uLIk3WdDiPJRR3mfqC266qwsppGXM/WAweqddoWk2bPutWU3pU+hkxi9+oddmWx1JIqWOA3ZF8JGvr8FMq7OTNxvR3rUrYJvMoPWaQta3b0AC4xhQrmlmA8TkldRIHK4xM5TemGZ7FXl/HNKWw4fjLb9QN6PiaLrDQNG1qLbmOHoTeiuFLEbeR7VHLDnRm6NzaD6N16blksRqaYLHA9tgJhdFjmZM3STeZ5fuw0d7CNlFu94L9RPAv0RASy3U8/XgNeay75K9/5CUrTZ+IIlPCKw/Kr/1vW/l/cT6UKwyv6k774a44EUvBDbMHPQn5vIzXMHmI0dzFYfd0iimR0mmdcmvFW4jBSlRYbWyZR63wedRoe5NNDKOAklj/+B5jDAPEqqdTBLaJ4jwxUz+tM+oSZrzunuQMDzytcg8kZLLA/G974sfw="
    - export GIT_AUTHOR_NAME="esg-bot"
    - export GIT_AUTHOR_EMAIL="tech@endemolshine.com"
    - export GIT_COMMITTER_NAME="esg-bot"
    - export GIT_COMMITTER_EMAIL="tech@endemolshine.com"

jobs:
  include:
    - stage: coverage
      if: type != pull_request
      before_script:
        - curl -L https://codeclimate.com/downloads/test-reporter/test-reporter-latest-linux-amd64 > ./cc-test-reporter
        - chmod +x ./cc-test-reporter
        - ./cc-test-reporter before-build
      after_script:
        - ./cc-test-reporter after-build --exit-code $TRAVIS_TEST_RESULT
      after_success:
        - yarn global add codecov
        - codecov
    - stage: release
      if: branch = master AND type != pull_request
      after_success:
        - yarn semantic-release
        - git clone https://${GH_TOKEN}@github.com/$TRAVIS_REPO_SLUG.git $TRAVIS_REPO_SLUG
        - cd $TRAVIS_REPO_SLUG
        - git fetch --all
        - git merge origin/master
        - git push
